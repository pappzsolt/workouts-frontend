<h2 class="programs-title">Felhaszn√°l√≥ keres√©s</h2>

<!-- Hiba / info √ºzenet -->
<div *ngIf="errorMessage" class="message-box">
  {{ errorMessage }}
</div>
<div *ngIf="message && !errorMessage" class="message-box message-success">
  {{ message }}
</div>

<!-- Keres≈ëmez≈ë + gomb -->
<div class="w-full max-w-4xl flex flex-col sm:flex-row items-center mb-6 space-y-3 sm:space-y-0 sm:space-x-4">
  <input
    type="text"
    [(ngModel)]="keyword"
    placeholder="√çrj be egy kulcssz√≥t..."
    class="form-input flex-1 w-full"
  />
  <button (click)="onSearch()" [disabled]="loading" class="form-button w-full sm:w-auto">
    Keres√©s
  </button>
</div>

<!-- N√©zetv√°lt√°s gombok -->
<div class="w-full max-w-4xl flex justify-end mb-4 space-x-2" *ngIf="displayedMembers.length >= 1">
  <button
    (click)="viewMode='grid'"
    [class]="viewMode === 'grid' ? 'px-4 py-2 rounded-lg bg-blue-500 text-white' : 'px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300'">
    K√°rtya n√©zet
  </button>
  <button
    (click)="viewMode='table'"
    [class]="viewMode === 'table' ? 'px-4 py-2 rounded-lg bg-blue-500 text-white' : 'px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300'">
    T√°bl√°zat n√©zet
  </button>
</div>

<!-- Loading -->
<div *ngIf="loading" class="text-gray-600 mb-4">Keres√©s folyamatban...</div>

<!-- Tal√°latok / nincs tal√°lat -->
<ng-container *ngIf="!loading && !errorMessage">
  <div *ngIf="displayedMembers.length > 0; else noMembers">
    <!-- Grid n√©zet -->
    <div *ngIf="viewMode==='grid'" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 w-full">
      <ng-container *ngFor="let member of displayedMembers">
        <div class="program-card flex flex-col items-start p-6 rounded-2xl shadow-md hover:shadow-xl transition border border-gray-100 w-full">
          <div class="program-image mb-3 flex justify-center w-full">
            <span class="program-emoji text-4xl">üë§</span>
          </div>
          <div class="program-content w-full">
            <div class="program-name font-semibold text-lg mb-1">{{ member.usernameOrName }}</div>
            <div class="program-description text-gray-600 mb-1">{{ member.email }}</div>
            <div class="text-gray-500 text-sm mb-2">Szerepk√∂r: {{ member.roles.join(', ') }}</div>

            <div *ngIf="member.extraFields && (member.extraFields | keyvalue).length" class="text-gray-600 text-sm mb-2">
              <div *ngFor="let kv of member.extraFields | keyvalue">
                <ng-container *ngIf="kv.key !== 'coach_id'">
                  <strong>{{ kv.key }}:</strong> {{ kv.value }}
                </ng-container>
              </div>
            </div>

            <div *ngIf="member.coach" class="text-gray-600 text-sm">
              <div><strong>Coach:</strong> {{ member.coach.usernameOrName }}</div>
              <div>{{ member.coach.email }}</div>
            </div>
          </div>
        </div>
      </ng-container>
    </div>

    <!-- T√°bl√°zat n√©zet -->
    <div *ngIf="viewMode==='table'" class="overflow-x-auto">
      <table class="w-full text-left border-collapse border border-gray-200">
        <thead class="bg-gray-100">
        <tr>
          <th class="px-4 py-2 border border-gray-200">N√©v</th>
          <th class="px-4 py-2 border border-gray-200">Email</th>
          <th class="px-4 py-2 border border-gray-200">Szerepk√∂r</th>
          <th class="px-4 py-2 border border-gray-200">Extra adatok</th>
          <th class="px-4 py-2 border border-gray-200">Coach</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let member of displayedMembers" class="hover:bg-gray-50">
          <td class="px-4 py-2 border border-gray-200">{{ member.usernameOrName }}</td>
          <td class="px-4 py-2 border border-gray-200">{{ member.email }}</td>
          <td class="px-4 py-2 border border-gray-200">{{ member.roles.join(', ') }}</td>
          <td class="px-4 py-2 border border-gray-200">
            <ng-container *ngIf="member.extraFields && (member.extraFields | keyvalue).length">
              <div *ngFor="let kv of member.extraFields | keyvalue" class="text-sm">
                <ng-container *ngIf="kv.key !== 'coach_id'">
                  <strong>{{ kv.key }}:</strong> {{ kv.value }}
                </ng-container>
              </div>
            </ng-container>
          </td>
          <td class="px-4 py-2 border border-gray-200">
            <ng-container *ngIf="member.coach">
              <p><strong>{{ member.coach.usernameOrName }}</strong></p>
              <p>{{ member.coach.email }}</p>
            </ng-container>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Nincs tal√°lat -->
  <ng-template #noMembers>
    <div class="no-programs">Nincs tal√°lat a keres√©sre.</div>
  </ng-template>
</ng-container>

<!-- Lapoz√°s -->
<div *ngIf="totalPages > 1" class="flex justify-center items-center space-x-2 mt-6">
  <button (click)="prevPage()" [disabled]="currentPage===1"
          class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 disabled:bg-gray-100">
    El≈ëz≈ë
  </button>

  <ng-container *ngFor="let page of [].constructor(totalPages); let i = index">
    <button (click)="goToPage(i+1)"
            [class]="currentPage===i+1 ? 'px-3 py-1 rounded bg-blue-500 text-white' : 'px-3 py-1 rounded bg-gray-200 hover:bg-gray-300'">
      {{ i+1 }}
    </button>
  </ng-container>

  <button (click)="nextPage()" [disabled]="currentPage===totalPages"
          class="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300 disabled:bg-gray-100">
    K√∂vetkez≈ë
  </button>
</div>
